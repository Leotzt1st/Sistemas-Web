<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <form method="post" action="incluir.php">
  <title>Gerenciar Usuários</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
 
<div class="container mt-4">
  <h2 class="mb-4">Gerenciar Usuários</h2>
 
  <form class="row g-2 mb-3">
    <input type="hidden" id="id">
 
    <div class="col-md-2">
      <input type="text" id="login" class="form-control" placeholder="Login">
    </div>
 
    <div class="col-md-2">
      <input type="text" id="nome" class="form-control" placeholder="Nome">
    </div>
 
    <div class="col-md-2">
      <input type="email" id="email" class="form-control" placeholder="Email">
    </div>
 
    <div class="col-md-2">
      <input type="password" id="senha" class="form-control" placeholder="Senha">
    </div>
 
    <div class="col-md-2">
      <select id="ativo" class="form-select">
        <option value="1" selected>Sim</option>
        <option value="0">Não</option>
      </select>
    </div>
 
    <div class="col-md-2 d-flex gap-2">
      <button type="button" class="btn btn-success" onclick="salvar()">Salvar</button>
      <button type="reset" class="btn btn-secondary" onclick="limpar()">Cancelar</button>
    </div>
 
    <div class="col-md-12 d-flex gap-2 mt-2">
      <input type="text" id="pesquisa" class="form-control" placeholder="Pesquisar...">
      <button type="button" class="btn btn-primary" onclick="carregarPesquisa()">Pesquisar</button>
      <button type="button" class="btn btn-outline-dark" onclick="carregar()">Listar Todos</button>
    </div>
  </form>
 
  <div class="table-responsive">
    <table id="tabela" class="table table-bordered table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Login</th>
          <th>Nome</th>
          <th>Email</th>
          <th>Ativo</th>
          <th class="text-center">Ações</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
</div>
 
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const API_URL = "http://localhost:8081/api/usuarios.php ";
const tbody = document.querySelector("#tabela tbody");
 
function carregar(pesquisa = "") {
    let url = API_URL;
    if (pesquisa) {
        url += "?pesquisa=" + encodeURIComponent(pesquisa);
    }
 
    fetch(url)
        .then(resposta => resposta.json())
        .then(dados => {
            dados.forEach(usuario => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${usuario.ID}</td>
                    <td>${usuario.LOGIN}</td>
                    <td>${usuario.NOME}</td>
                    <td>${usuario.EMAIL}</td>
                    <td>${usuario.ATIVO == 1 ? "Sim" : "Não"}</td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-warning" onclick='editar(${JSON.stringify(usuario)})'>Editar</button>
                        <button class="btn btn-sm btn-danger" onclick='excluir(${usuario.ID})'>Excluir</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        });
}
 
function carregarPesquisa() {
    const valor = document.getElementById("pesquisa").value;
    carregar(valor);
}
 
async function salvar() {
const id = document.getElementById("id").value;
const login = document.getElementById("login").value;
const nome = document.getElementById("nome").value;
 const email = document.getElementById("email").value;
const senha = document.getElementById("senha").value;
const ativo = document.getElementById("ativo").value;
 
 
const payload = { ID: id, LOGIN: login, NOME: nome, EMAIL: email, SENHA: senha, ATIVO: ativo };
 const metodo = id ? "PUT" : "POST";
 
     console.log("Payload:", payload);
 
 
 
    await fetch(API_URL, { method: metodo, body: JSON.stringify(payload) });
 
 
    limpar();
    carregar();
}
 
function editar(usuario) {
    document.getElementById("id").value = usuario.ID;
    document.getElementById("login").value = usuario.LOGIN;
    document.getElementById("nome").value = usuario.NOME;
    document.getElementById("email").value = usuario.EMAIL;
    document.getElementById("senha").value = usuario.SENHA;
    document.getElementById("ativo").value = usuario.ATIVO;
}
 
async function excluir(id) {
    if (confirm("Deseja excluir este usuário?")) {
        await fetch(API_URL + "?id=" + id, { method: "DELETE" });
        carregar();
    }
}
 
function limpar() {
    document.getElementById("id").value = "";
    document.getElementById("login").value = "";
    document.getElementById("nome").value = "";
    document.getElementById("email").value = "";
    document.getElementById("senha").value = "";
    document.getElementById("ativo").value = "1";
}
 
carregar();
 
</script>
 
</body>
</html>
>